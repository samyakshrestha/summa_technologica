problem_framer_task:
  description: >
    You are given:
    - Question: {question}
    - Domain: {domain}
    - Objective: {objective}

    Produce a strict JSON object only with keys:
    - restated_question: string
    - assumptions: array of 3-7 strings
    - scope_limits: array of 2-6 strings
    - thesis_directions: array of exactly 2 strings
    - refined_query: string (optimized for academic retrieval terms)

    Requirements:
    - No markdown, no prose outside JSON.
    - Keep all fields concrete and domain-specific.
  expected_output: >
    Valid JSON problem memo for downstream retrieval and hypothesis generation.

literature_scout_task:
  description: >
    You are given:
    - Problem memo JSON: {problem_memo_json}
    - Retrieved papers JSON from Semantic Scholar: {retrieval_json}

    Produce a strict JSON object only with keys:
    - evidence_summary: string
    - high_signal_findings: array of 3-8 strings
    - citation_shortlist: array of paper_id/doi strings selected from retrieved papers only
    - gaps_and_uncertainties: array of 2-6 strings

    Requirements:
    - Do not invent papers.
    - Use only IDs/DOIs that appear in retrieval_json.
    - If no papers were retrieved, explicitly state that in evidence_summary and return empty citation_shortlist.
  expected_output: >
    Valid JSON evidence memo grounded in provided Semantic Scholar retrieval output.

hypothesis_generator_task:
  description: >
    You are given:
    - Question: {question}
    - Domain: {domain}
    - Objective: {objective}
    - Problem memo JSON: {problem_memo_json}
    - Evidence memo JSON: {evidence_memo_json}
    - Grounded papers JSON: {retrieval_json}

    Produce strict JSON with key:
    - hypotheses: array of 3-5 objects

    Each hypothesis object must contain keys:
    - id: short string id like h1, h2
    - title: string
    - statement: string
    - mechanism_cause: string (what causal factor drives the effect)
    - mechanism_substrate: string (what system/entity the cause acts on)
    - mechanism_intervention: string (how to manipulate it experimentally)
    - mechanism_signal: string (what measurable signal should change)
    - novelty_rationale: string
    - plausibility_rationale: string
    - testability_rationale: string
    - falsifiable_predictions: array with at least 1 string.
      Each prediction must be conditional ("If X, then Y within Z timeframe")
      or quantitative ("Metric M changes by at least N%").
      Avoid vague phrases such as "will improve" without measurable anchors.
    - minimal_experiments: array with at least 1 string
    - citations: array of citation objects with keys title, authors, year and paper_id or doi.
      IMPORTANT: Copy the paper_id value exactly as it appears in retrieval_json.
      Do not abbreviate, modify, or invent paper_id values.
      Each hypothesis should cite at least 1 paper from retrieval_json.

    Distinctness requirements:
    - Every pair must differ on at least one axis:
      (a) causal mechanism, (b) empirical domain, or (c) theoretical framework.
    - Prefer hypotheses with clearly different mechanism_cause values.

    Constraints:
    - Use only grounded citations from retrieval_json.
    - No markdown, no extra keys.
  expected_output: >
    Valid JSON with distinct hypotheses and grounded citations.

critic_task:
  description: >
    You are given:
    - Question: {question}
    - Domain: {domain}
    - Hypotheses JSON: {hypotheses_json}

    Produce strict JSON with keys:
    - hypotheses: array of kept hypotheses (3-5 items)
      each hypothesis must include ALL of:
      id, title, statement, novelty_rationale, plausibility_rationale,
      testability_rationale, falsifiable_predictions, minimal_experiments, citations,
      objections, replies

    CRITICAL - objections and replies format:
    Every hypothesis MUST have exactly 3 objections and exactly 3 replies.
    Do NOT omit them. Do NOT return fewer than 3.
    objections format: [{"number": 1, "text": "..."}, {"number": 2, "text": "..."}, {"number": 3, "text": "..."}]
    replies format: [{"objection_number": 1, "text": "..."}, {"objection_number": 2, "text": "..."}, {"objection_number": 3, "text": "..."}]
    Each objection should identify a genuine weakness, empirical gap, or logical flaw.
    Each reply should directly address the corresponding objection.

    - distinctness_matrix: array of pair objects with keys:
      hypothesis_a_id, hypothesis_b_id, axis, verdict, keep_id, collapse_id, rationale

    Rules:
    - verdict is either DISTINCT or NOT_DISTINCT.
    - axis is one of mechanism, empirical_domain, theoretical_framework, none.
    - For NOT_DISTINCT, keep_id and collapse_id must be non-empty and different.
    - If collapsing, retain the stronger and more specific mechanism.
    - Preserve citation grounding as provided.
  expected_output: >
    Valid JSON with audited distinctness and strengthened objections/replies.

ranker_task:
  description: >
    You are given:
    - Domain: {domain}
    - Critic output JSON: {critic_json}

    Produce strict JSON with key:
    - comparisons: array of pairwise comparison objects

    Each comparison object must contain:
    - hypothesis_a_id
    - hypothesis_b_id
    - winner_novelty (a|b|tie)
    - winner_plausibility (a|b|tie)
    - winner_testability (a|b|tie)
    - rationale: short string

    Requirements:
    - Cover all unordered pairs exactly once for surviving hypotheses.
    - Use pairwise judgments, not raw numeric scores.
    - Use "tie" only when both hypotheses are genuinely indistinguishable on that axis.
      Otherwise choose "a" or "b".
    - Calibration anchors:
      novelty = not a restatement of known ideas,
      plausibility = has empirical/theoretical support,
      testability = can be falsified by a concrete experiment within ~1 year.
    - No markdown, no extra keys.
  expected_output: >
    Valid JSON pairwise judgments for all hypothesis pairs.

summa_composer_task:
  description: >
    You are given:
    - Question: {question}
    - Domain: {domain}
    - Top hypotheses JSON: {top_hypotheses_json}
    - Ranking order JSON: {ranking_json}
    - Requested top count: {top_count}

    Produce strict JSON with key:
    - summa_rendering: string

    Rendering rules:
    - For each rendered block, use this structure in order:
      Question, Objection 1, Objection 2, Objection 3,
      On the contrary, I answer that, Reply to Objection 1, Reply to Objection 2, Reply to Objection 3.

    Section-by-section requirements:

    QUESTION: State the question as "Whether [hypothesis title in question form]."

    OBJECTIONS (1-3): Each objection must be 2-4 sentences presenting a genuine
    weakness, empirical gap, or logical flaw. Start each with "Objection N."
    Use the objections from the hypothesis data.

    ON THE CONTRARY: This section must cite evidence that SUPPORTS the hypothesis.
    Reference a specific grounded paper or established finding from the citations.
    Format: "On the contrary, [Author] ([Year]) demonstrated that [finding],
    which supports the claim that [brief link to hypothesis]."
    Do NOT paste another hypothesis's claim here. Do NOT be vague.

    I ANSWER THAT: This is the core section. Write 2-3 substantive paragraphs:
    - Paragraph 1: Explain the causal mechanism — what causes what, acting on
      what substrate, and why this mechanism is plausible.
    - Paragraph 2: Connect to evidence — which papers support this, what do
      they show, and how does the hypothesis go beyond existing work.
    - Paragraph 3: State the testable prediction — what specific experiment
      would confirm or falsify this, and what measurable outcome to expect.
    Use the hypothesis's mechanism_cause, mechanism_substrate, citations, and
    falsifiable_predictions to construct these paragraphs.

    REPLIES TO OBJECTIONS (1-3): Each reply must directly address the
    corresponding objection with a specific counter-argument or evidence.
    Start each with "Reply to Objection N." Write 2-3 sentences, not
    generic dismissals.

    Additional rules:
    - If top_count is 1: render one block for rank #1.
    - If top_count is 3: render up to three blocks, separated by a line containing ---
    - Objections and replies must align by number.
    - Do not output JSON other than {"summa_rendering": "..."}.
  expected_output: >
    Valid JSON containing a complete Summa rendering string with substantive
    On-the-contrary citations and multi-paragraph I-answer-that explanations.
